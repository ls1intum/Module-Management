<h2 class="text-xl font-semibold mb-4">Users & Roles</h2>
<p class="text-muted-foreground mb-6">View all users and assign or change their roles.</p>

<div class="flex gap-2 mb-4">
  <input pInputText type="text" [(ngModel)]="searchQuery" placeholder="Search by name, email, or username" (keyup.enter)="runSearch()" class="flex-1 max-w-md" />
  <p-button label="Search" icon="pi pi-search" (onClick)="runSearch()" severity="contrast" />
</div>

<p-table
  [value]="users()"
  [lazy]="true"
  [paginator]="true"
  [first]="firstRowIndex()"
  [rows]="currentPageSize()"
  [totalRecords]="totalRecords()"
  [loading]="loading()"
  (onPage)="pageChange($event)"
  [rowsPerPageOptions]="[10, 25, 50]"
  [showCurrentPageReport]="true"
  currentPageReportTemplate="Showing users {first} to {last} of total {totalRecords} users"
>
  <ng-template pTemplate="header">
    <tr>
      <th>Name</th>
      <th>Username</th>
      <th>Email</th>
      <th>Roles</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-user>
    <tr>
      <td>{{ user.firstName }} {{ user.lastName }}</td>
      <td>{{ user.userName }}</td>
      <td>{{ user.email }}</td>
      <td>
        <p-multiSelect
          [options]="roles"
          [ngModel]="user.roles ?? []"
          (ngModelChange)="onRolesChange(user, $event)"
          [disabled]="isSaving(user.userId)"
          [loading]="isSaving(user.userId)"
          optionLabel="label"
          optionValue="value"
          placeholder="Select roles"
          appendTo="body"
        />
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="4" class="text-center py-8 text-muted-foreground">No users found.</td>
    </tr>
  </ng-template>
</p-table>
